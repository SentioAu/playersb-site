<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Player Comparison (A vs B) | PlayersB — The Players Book</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Compare Player A vs Player B using normalized rates and clear tradeoffs: per-90, efficiency, and stability indicators." />

  <link rel="canonical" href="https://playersb.com/compare/" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />

  <!-- Open Graph -->
  <meta property="og:site_name" content="PlayersB — The Players Book" />
  <meta property="og:title" content="Player Comparison (A vs B) | PlayersB" />
  <meta property="og:description" content="Compare players using normalized rates (per-90), efficiency context, and explainable indicators." />
  <meta property="og:url" content="https://playersb.com/compare/" />
  <meta property="og:type" content="website" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Player Comparison (A vs B) | PlayersB" />
  <meta name="twitter:description" content="Compare players using normalized rates (per-90), efficiency context, and explainable indicators." />
  <link rel="stylesheet" href="/styles/site.css" />
  <meta name="theme-color" content="#2563eb" />

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-D5798TYENM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-D5798TYENM');
  </script>
</head>
<body>
  <div class="page">
    <header class="site-header">
      <div class="container header-inner">
        <a href="/" class="brand" aria-label="PlayersB homepage">
          <span class="brand-title">PlayersB</span>
          <span class="brand-subtitle">The Players Book</span>
        </a>
        <nav class="site-nav" aria-label="Primary">
          <a class="nav-link" href="/">Home</a>
          <a class="nav-link" href="/players/">Players</a>
          <a class="nav-link" href="/compare/">Compare</a>
          <a class="nav-link" href="/tools/">Tools</a>
          <a class="nav-link" href="/learn/">Learn</a>
          <a class="nav-link" href="/about/">About</a>
          <a class="nav-link" href="/contact/">Contact</a>
        </nav>
        <button id="themeToggle" class="button small secondary theme-toggle" type="button" aria-pressed="false">
          Dark mode
        </button>
        <a class="button small" href="/players/">Browse players</a>
      </div>
    </header>

    <main class="container main-content">
      <section class="hero">
        <span class="pill">Comparison Tool</span>
        <h1>Compare players with clear, normalized context.</h1>
        <p class="lead">Per-90 rates, efficiency indicators, and shareable summaries — educational only.</p>
      </section>

      <section class="section">
        <div class="card">
          <div class="compare-controls">
            <div style="flex:1;min-width:240px;">
              <label for="playerA" class="meta-text">Player A</label>
              <select id="playerA" class="select"></select>
            </div>
            <div style="flex:1;min-width:240px;">
              <label for="playerB" class="meta-text">Player B</label>
              <select id="playerB" class="select"></select>
            </div>
            <div>
              <button id="swap" class="button secondary" type="button">Swap</button>
            </div>
          </div>

          <div class="share-row">
            <span>Shareable link: <span id="shareUrl" style="word-break:break-all;"></span></span>
            <button id="copyShare" type="button" class="button small secondary">Copy link</button>
            <span id="shareStatus" class="meta-text" aria-live="polite"></span>
          </div>
        </div>
      </section>

      <section id="result" class="compare-result"></section>
    </main>

    <footer class="site-footer">
      <div class="container">
        <p><strong>Disclaimer:</strong> Educational tool. No betting or sportsbook activity. Outputs are indicators based on historical/verified data — not guarantees.</p>
        <div class="footer-links">
          <a href="/privacy/">Privacy</a>
          <a href="/terms/">Terms</a>
          <a href="/contact/">Contact</a>
        </div>
      </div>
    </footer>
  </div>

  <script>
    (function () {
      const storageKey = "playersb-theme";
      const root = document.documentElement;
      const stored = localStorage.getItem(storageKey);
      const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
      const initialTheme = stored || (prefersDark ? "dark" : "light");

      if (initialTheme === "dark") {
        root.setAttribute("data-theme", "dark");
      }

      function updateButton(button) {
        const isDark = root.getAttribute("data-theme") === "dark";
        button.textContent = isDark ? "Light mode" : "Dark mode";
        button.setAttribute("aria-pressed", String(isDark));
      }

      document.addEventListener("DOMContentLoaded", () => {
        const button = document.getElementById("themeToggle");
        if (!button) return;
        updateButton(button);
        button.addEventListener("click", () => {
          const isDark = root.getAttribute("data-theme") === "dark";
          if (isDark) {
            root.removeAttribute("data-theme");
            localStorage.setItem(storageKey, "light");
          } else {
            root.setAttribute("data-theme", "dark");
            localStorage.setItem(storageKey, "dark");
          }
          updateButton(button);
        });
      });
    })();
  </script>

  <script>
    const DATA_URL = "/data/players.json";

    const $A = document.getElementById("playerA");
    const $B = document.getElementById("playerB");
    const $swap = document.getElementById("swap");
    const $result = document.getElementById("result");
    const $share = document.getElementById("shareUrl");
    const $copy = document.getElementById("copyShare");
    const $status = document.getElementById("shareStatus");

    const round = (n, d=2) => Number.isFinite(n) ? (Math.round(n * (10**d)) / (10**d)) : 0;
    const per90 = (value, minutes) => minutes > 0 ? (value / (minutes / 90)) : 0;
    const num = (v) => (typeof v === "number" && Number.isFinite(v)) ? v : 0;

    function sanitizeId(raw) {
      return String(raw ?? "")
        .trim()
        .toLowerCase()
        .replace(/[^a-z0-9-]/g, "-")
        .replace(/-+/g, "-")
        .replace(/^-|-$/g, "");
    }

    function getQuery() {
      const p = new URLSearchParams(location.search);
      return { a: p.get("a"), b: p.get("b") };
    }

    function shareUrlFor(a, b) {
      const p = new URLSearchParams();
      if (a) p.set("a", a);
      if (b) p.set("b", b);
      const qs = p.toString();
      return `${location.origin}${location.pathname}${qs ? "?" + qs : ""}`;
    }

    function setQuery(a, b) {
      const url = shareUrlFor(a, b);
      history.replaceState({}, "", url);
      $share.textContent = url;
    }

    async function copyShare() {
      const url = $share.textContent.trim();
      if (!url) return;
      if ($status) $status.textContent = "";

      try {
        if (navigator.clipboard?.writeText) {
          await navigator.clipboard.writeText(url);
        } else {
          const temp = document.createElement("textarea");
          temp.value = url;
          temp.setAttribute("readonly", "");
          temp.style.position = "absolute";
          temp.style.left = "-9999px";
          document.body.appendChild(temp);
          temp.select();
          document.execCommand("copy");
          temp.remove();
        }
        if ($status) $status.textContent = "Copied.";
      } catch (err) {
        if ($status) $status.textContent = "Unable to copy. Select the link to copy manually.";
        console.error(err);
      }
    }

    function optionLabel(p) {
      const pos = p.position || "";
      const team = p.team || "";
      return `${p.name} — ${pos} — ${team}`.replace(/\s+—\s+—\s+/, " — ").trim();
    }

    function buildSelect($el, players) {
      $el.innerHTML = "";
      for (const p of players) {
        const opt = document.createElement("option");
        opt.value = sanitizeId(p.id);
        opt.textContent = optionLabel(p);
        $el.appendChild(opt);
      }
    }

    function getById(players, id) {
      const sid = sanitizeId(id);
      return players.find(p => sanitizeId(p.id) === sid) || players[0];
    }

    function calc(p) {
      const minutes = num(p.minutes);

      const goals = num(p.goals);
      const assists = num(p.assists);
      const shots = num(p.shots);
      const shotsOnTarget = num(p.shotsOnTarget);

      const g90 = per90(goals, minutes);
      const a90 = per90(assists, minutes);
      const s90 = per90(shots, minutes);
      const sot90 = per90(shotsOnTarget, minutes);

      const shotAccuracy = shots > 0 ? (shotsOnTarget / shots) : 0;
      const goalPerShot = shots > 0 ? (goals / shots) : 0;

      return { g90, a90, s90, sot90, shotAccuracy, goalPerShot };
    }

    function barRow(label, aVal, bVal, fmt, note="") {
      const max = Math.max(aVal, bVal, 0.00001);
      const aPct = (aVal / max) * 100;
      const bPct = (bVal / max) * 100;

      return `
        <div class="bar-row">
          <div class="bar-row-header">
            <div class="bar-row-title">${label}</div>
            <div class="bar-row-note">${note}</div>
          </div>
          <div class="bar-row-grid">
            <div class="bar-track">
              <div class="bar-fill" style="width:${aPct}%;"></div>
            </div>
            <div class="bar-values">${fmt(aVal)} vs ${fmt(bVal)}</div>
            <div class="bar-track">
              <div class="bar-fill is-b" style="width:${bPct}%;"></div>
            </div>
          </div>
        </div>
      `;
    }

    function render(players) {
      const a = getById(players, $A.value);
      const b = getById(players, $B.value);
      const A = calc(a);
      const B = calc(b);

      const aId = sanitizeId(a.id);
      const bId = sanitizeId(b.id);

      setQuery(aId, bId);

      const fmt2 = (x) => round(x, 2).toFixed(2);
      const fmtPct = (x) => `${Math.round(x * 100)}%`;

      $result.innerHTML = `
        <section class="card">
          <div class="card-grid" style="grid-template-columns:repeat(auto-fit, minmax(240px, 1fr));">
            <div>
              <h2>${a.name}</h2>
              <div class="meta-text">${a.position || ""} · ${a.team || ""}</div>
              <div class="stat-grid">
                <div class="stat">
                  <div class="stat-label">Minutes</div>
                  <div class="stat-value">${num(a.minutes)}</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Goals</div>
                  <div class="stat-value">${num(a.goals)}</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Assists</div>
                  <div class="stat-value">${num(a.assists)}</div>
                </div>
              </div>
              <div class="button-row" style="margin-top:12px;">
                <a class="button small secondary" href="/players/${encodeURIComponent(aId)}/">Open player page</a>
              </div>
            </div>
            <div>
              <h2>${b.name}</h2>
              <div class="meta-text">${b.position || ""} · ${b.team || ""}</div>
              <div class="stat-grid">
                <div class="stat">
                  <div class="stat-label">Minutes</div>
                  <div class="stat-value">${num(b.minutes)}</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Goals</div>
                  <div class="stat-value">${num(b.goals)}</div>
                </div>
                <div class="stat">
                  <div class="stat-label">Assists</div>
                  <div class="stat-value">${num(b.assists)}</div>
                </div>
              </div>
              <div class="button-row" style="margin-top:12px;">
                <a class="button small secondary" href="/players/${encodeURIComponent(bId)}/">Open player page</a>
              </div>
            </div>
          </div>

          <div class="section">
            <h3>Normalized output (per 90)</h3>
            ${barRow("Goals / 90", A.g90, B.g90, fmt2, "Rate-adjusted finishing")}
            ${barRow("Assists / 90", A.a90, B.a90, fmt2, "Playmaking rate")}
            ${barRow("Shots / 90", A.s90, B.s90, fmt2, "Volume proxy")}
            ${barRow("Shots on target / 90", A.sot90, B.sot90, fmt2, "On-frame volume")}
          </div>

          <div class="section">
            <h3>Efficiency context</h3>
            ${barRow("Shot accuracy", A.shotAccuracy, B.shotAccuracy, fmtPct, "SOT / shots")}
            ${barRow("Goals per shot", A.goalPerShot, B.goalPerShot, fmt2, "Goals / shots")}
          </div>

          <div class="callout">
            <strong>How to read this:</strong>
            <ul class="info-list">
              <li><strong>Per-90</strong> helps compare players with different minutes.</li>
              <li><strong>Shots/90</strong> is a rough volume signal; <strong>goals per shot</strong> is a rough efficiency signal.</li>
              <li>These are educational indicators, not guarantees.</li>
            </ul>
          </div>
        </section>
      `;
    }

    async function main() {
      const res = await fetch(DATA_URL, { cache: "no-store" });
      const payload = await res.json();
      const players = payload.players || [];

      if (!players.length) {
        $result.innerHTML = `<p style="color:#b00;">No player data found. Please run the data builder workflow.</p>`;
        return;
      }

      buildSelect($A, players);
      buildSelect($B, players);

      const q = getQuery();
      if (q.a && players.some(p => sanitizeId(p.id) === sanitizeId(q.a))) $A.value = sanitizeId(q.a);
      if (q.b && players.some(p => sanitizeId(p.id) === sanitizeId(q.b))) $B.value = sanitizeId(q.b);

      if (!$B.value) $B.value = sanitizeId(players[1]?.id) || sanitizeId(players[0].id);

      $share.textContent = shareUrlFor($A.value, $B.value);

      $A.addEventListener("change", () => render(players));
      $B.addEventListener("change", () => render(players));
      if ($copy) $copy.addEventListener("click", copyShare);

      $swap.addEventListener("click", () => {
        const tmp = $A.value;
        $A.value = $B.value;
        $B.value = tmp;
        render(players);
      });

      render(players);
    }

    main().catch(err => {
      $result.innerHTML = `<p style="color:#b00;">Error loading data. Please try again later.</p>`;
      console.error(err);
    });
  </script>
</body>
</html>
